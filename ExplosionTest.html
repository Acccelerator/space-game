<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>


<style>
    body {
        margin: 0;
        padding: 0;
    }
</style>

<script src="res/js/lib/threejs/three.js"></script>
<script src="res/js/lib/jquery-2.2.4.min.js"></script>
<script src="app/ImplosionParticleRenderer.js"></script>
<script src="app/ExplosionParticleRenderer.js"></script>
<script src="app/ParticleHandler.js"></script>
<script src="app/FileLoader.js"></script>




<script type="text/javascript">

    var camera, scene, renderer;
    var fileLoader = FileLoader();

    var particleHandler = ParticleHandler();

    $(function () {

        var container;
        var tick;
        var clock = new THREE.Clock(true);

        // start
        var loadingLoop = setInterval(function() {
            console.log("loading");
            if (fileLoader.isReady()) {
                console.log("done");
                clearInterval(loadingLoop);
                init();
                animate();
            }
        }, 50);



        function init() {

            // HTML-Container erzeugen
            container = document.createElement('div');
            document.body.appendChild(container);

            // Kamera und Szene erzeugen
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0009);
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
            camera.position.set(12, 15, -20);
            camera.lookAt(scene.position);

            // Renderer
            renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // Licht
            var light = new THREE.DirectionalLight(0xffffff);
            light.position.set(3, 6, 0);
            scene.add(light);


            // Skybox
            var geometrySkysphere = new THREE.SphereGeometry(1000, 256, 256);
            var materialSkysphere = new THREE.MeshBasicMaterial({
                map: fileLoader.get("sky_sphere_map"),
                side: THREE.DoubleSide
            });
            sphere = new THREE.Mesh(geometrySkysphere, materialSkysphere);
            scene.add(sphere);

            // Event-Listener f√ºr Resize
            window.addEventListener("resize", onWindowResize, false);





            var gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);
            var axisHelper = new THREE.AxisHelper(10);
            scene.add(axisHelper);

            setTimeout(function() {
                particleHandler.addImplosion(new THREE.Vector3(0, 0, 0));
            },1000);



        }



        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }


        function animate() {
            requestAnimationFrame(animate);
            render();

            particleHandler.update();
        }


        function render() {
            // dont touch!
            renderer.render(scene, camera);

        }


    });

</script>


<body>

</body>
</html>