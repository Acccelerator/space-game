<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>SpaceGame</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="res/css/lib/bootstrap.css" />
    <link rel="stylesheet" href="res/css/lib/sb-admin-2.css" />
    <link rel="stylesheet" href="res/css/index.css" />

    <!-- Javascript -->
    <script src="res/js/lib/jquery-2.2.4.min.js"></script>
    <script src="res/js/lib/bootstrap.min.js"></script>
    <script src="res/js/lib/threejs/three.js"></script>
    <script src="res/js/lib/threejs/tween.min.js"></script>

    <!-- custom -->

    <script src="app/RayParticleRenderer.js"></script>

    <script>
        $(function() {
            var particlePathLength = 5;

            var camera, scene, renderer, particleSystem, particleCount, particles;

            var particleRenderer = new ParticleRenderer();

            init();
            animate();

            function init() {
                window.addEventListener("resize", onWindowResize, false);

                // HTML-Container erzeugen
                container = document.createElement('div');
                document.body.appendChild(container);

                // Kamera und Szene erzeugen
                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x000000, 0.0009);
                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
                camera.position.set(12, 15, -20);
                camera.lookAt(scene.position);

                // Renderer
                renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);

                scene.add(new THREE.AmbientLight(0x404040));


                /**************************** Particle System ********************************/


                var axes = new THREE.AxisHelper(50);
                scene.add(axes); // rot: x, blau: y, gr√ºn: z

                var gridXZ = new THREE.GridHelper(10, 1);
                scene.add(gridXZ);



                // create the particle variables
                particleCount = 100;
                particles = new THREE.Geometry();
                var pMaterial = new THREE.PointCloudMaterial(
                        {
                            color: 0xFFFFFF,
                            size: 1,
                            map: THREE.ImageUtils.loadTexture(
                                    "res/textures/particle.png"
                            ),
                            blending: THREE.AdditiveBlending,
                            transparent: true
                        }
                );

                // now create the individual particles
                for (var p = 0; p < particleCount; p++) {
                    // create a particle with random
                    // position values, -250 -> 250
                    var particle = new THREE.Vector3(
                            Math.sin(Math.random())-0.5,
                            particlePathLength-Math.random()*particlePathLength,
                            Math.cos(Math.random())-0.5
                    );

                    // add it to the geometry
                    particle.velocity = new THREE.Vector3(0, -Math.random()*0.01, 0);
                    particles.vertices.push(particle);
                }

                // create the particle system
                particleSystem = new THREE.PointCloud(
                        particles,
                        pMaterial);

                // add it to the scene
                scene.add(particleSystem);

            }

            function animate() {

                requestAnimationFrame(animate);
                render();
            }

            function render() {

                /*//particleSystem.rotation.y += 0.01;
                var pCount = particleCount;


                while (pCount--) {
                    var particle = particles.vertices[pCount];
                    if (particle.y < 0) {
                        particle.y = particlePathLength;
                        particle.velocity.y = 0;
                    }

                    particle.velocity.y -= Math.random() * 0.01;

                    particle.x += particle.velocity.x;
                    particle.y += particle.velocity.y;
                    particle.z += particle.velocity.z;

                    particleSystem.geometry.__dirtyVertices = true;
                }

                particles.verticesNeedUpdate = true;*/
                renderer.render(scene, camera);
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }


        });
    </script>

</head>

<body>


</body>

</html>